---
title: 開発環境
date: '2021-01-01'
type: book
weight: 20
---

ロボットシステムの開発環境に使われている要素の概要を理解する
<!--more-->

## スライド
https://docs.google.com/presentation/d/1-q6zq3vV91GTj7mw9uqwT4B8LyHDpFHBNVi4lEyCa5A/edit?usp=sharing

## Learn

### Linuxコマンド
| command |　説明 | option |
| ------- | ---- | ------ |
| ls      | ディレクトリ内のファイル・ディレクトリの表示 |  -l: 詳細を表示 -a: 全て表示|
| mkdir   | ディレクトリ作成 |  |
| cd      | ディレクトリ移動 |  |
| mv      | ファイル移動 |  |
| rm      | ファイル削除 | -r:ディレクトリ内を再起的に削除 -f:強制削除 |
| cat     |  |  |
|  |  |  |

### ssh

```
ssh <username>@<hostname> -p <port> -i <identity_file>
```

### エディタ
- vim
    - チュートリアル： `vimtuter`
- emacs

### git/GitHub
- gitとは
    - add
    - push
    - pull
    - fetch
    - clone
    - merge
    - reset
- GitHubとは
    - 

### docker
- Dockerとは

- DockerFileのビルド
    ```
    docker build -t <image_name>:<tag_name> -f <Dockerfile> <relative_dir>
    ```

- Docker Image
    ```
    # Docker image一覧
    docker images
    # Docker Imageのダウンロード
    docker pull <image_name>:<tag_name>
    # 削除
    docker rmi <image_id>
    # 不要なDocker imageを消す
    docker image prune
    ```

- Docker Container
    ```
    # Docker containerの起動
    docker run <image_name> <command>
    # Docker container一覧
    docker ps -a
    # Docker containerに接続
    docker exec -it <container_name> bash
    ```

    ※`docker run`でよく使うオプション
    - `-it` 
        - 標準入出力有効になる
    - `--name <container_name>`
        - コンテナの名前の指定
    - `--rm`
        - コンテナを抜けた際に自動的にコンテナを削除する
    - `--gpus all`
        - コンテナに全gpuを渡す
        - gpuの個数を指定する場合は all の代わりに数字(0, 1,...)
        - gpuを指定する場合は `--gpus '"device=0,1"'`
    - `-v <host/path/to/dir:container/path/to/dir>`
        - コンテナ内にホストのディレクトリをマウントする
    - `-p <host_port>:<container_port>`
        - ホストのポートをコンテナのポートにマップする
        - コンテナ内でwebサーバを動かす場合などに使う
    - `--net=host`
        - コンテナとホストでネットワークを共有する(IPアドレスなどが同じになる)
        - ROSノードをコンテナ内で動かす場合などはこれを使うと楽
    - `--privileged`
        - コンテナからのデバイスへのアクセスを許可
        - コンテナからWEBカメラにアクセスしたいときなど



## 演習

{{< spoiler text="【ssh】開発用PCにsshする" >}}
個人PCから開発PCにsshする
```shell
vim ~/.ssh/config
ssh robot_dev2
```
{{< /spoiler >}}

{{< spoiler text="【Linuxコマンド】グループのディレクトリを作成し移動する" >}}
先頭の`robot_dev2@robot-dev2:~$`は今後開発PCであることを意味します。
```shell
robot_dev2@robot-dev2:~$ mkdir group_a
robot_dev2@robot-dev2:~$ cd group_a
```
{{< /spoiler >}}

{{< spoiler text="【git】roomba_hackリポジトリをcloneし移動する" >}}

```shell
robot_dev2@robot-dev2:~/group_a$ git clone https://github.com/matsuolab/roomba_hack.git
robot_dev2@robot-dev2:~/group_a$ cd roomba_hack
```
{{< /spoiler >}}

{{< spoiler text="【git】ブランチを確認する" >}}
git branchコマンドを使ってみましょう。
```shell
robot_dev2@robot-dev2:~/group_a/roomba_hack$ git branch
```
{{< /spoiler >}}

{{< spoiler text="【docker】roomba_hackの開発環境のdocker imageをビルドする" >}}
shellファイルを実行してビルドを行います。
```
robot_dev2@robot-dev2:~/group_a/roomba_hack$ ./BUILD-DOCKER-IMAGE.sh
```
shellファイルの中身をcatコマンドで確認してみましょう。
```
robot_dev2@robot-dev2:~/group_a/roomba_hack$ cat BUILD-DOCKER-IMAGE.sh
```
細かいところは気にしなくていいですが、ファイルの最後の
```
docker build . -f docker/${DOCKERFILE_NAME} -t ${IMAGE_NAME}:${TAG_NAME} --build-arg BASE_IMAGE=${BASE_IMAGE}
```
でビルドが行われていることが確認できると思います。
{{< /spoiler>}}


{{< spoiler text="【ssh】jetsonにsshする" >}}
開発用PCからルンバに載っているjetson nanoへsshします。
```shell
robot_dev2@robot-dev2:~/group_a/roomba_hack$ ssh roomba_dev2
roomba_dev2@roomba-dev-jetson2:~$ 
```
先頭の表記が`roomba_dev2@roomba-dev-jetson2`と変わり、jetsonへ接続されたことがわかります。

今後先頭の`roomba_dev2@roomba-dev-jetson2`はjetsonであることを意味します。
{{< /spoiler>}}

{{< spoiler text="【ssh】VNCを使う" >}}
個人PCから開発PCにsshで接続
```shell
ssh robot_dev2 -L 5900:localhost:5900
```
手元のVNC viewerでlocalhost:5900を開く

{{< /spoiler>}}

